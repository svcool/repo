##BGP
========================
*создаем loopback для контроля*
R1(config)#int loopback 0
R1(config-if)#ip address 100.0.0.1 255.255.255.255
*Данный маршрут говорит о том, что все пакеты в эту подсеть будут отброшены, чтобы маршрутизатор считал, что такая сеть есть и пропишет loopback в таблицу маршрутизации*
R1(config)#ip route 100.0.0.0 255.255.254.0 Null 0
=================================
*R1*
R1(config)#router bgp 64500
*указываем соседей*
R1(config-router)#neighbor 101.0.0.1 remote-as 64501
>передаем сеть провайдеру
R1(config-router)#network 100.0.0.0 mask 255.255.254.0

*R2*
R2(config)#router bgp 64501
>передаем сеть провайдеру
network 101.0.0.0 mask 255.255.240.0
*указываем соседей*
neighbor 101.0.0.2 remote-as 64500
neighbor 101.0.0.6 remote-as 64502
neighbor 101.0.0.10 remote-as 64503
*передаем маршрут по умолчанию и фильтруем другие*
neighbor 102.0.0.2 default-originate 
neighbor 102.0.0.2 prefix-list DEFAULT out

*разрешаем все анонсы для 102.0.0.2 (указан в префиксе выше)*
ip prefix-list DEFAULT seq 5 permit 0.0.0.0/0
====================================
#просмотр
sh ip bgp
#очистка маршрутов
clear ip bgp 64501
============================================
#исключить маршрутизатор как транзитный
router bgp 64500
no synchronization
bgp log-neighbor-changes
network 100.0.0.0 mask 255.255.254.0
neighbor 101.0.0.1 remote-as 64501
*назначаем имя префикск листа для соседей*
* neighbor 101.0.0.1 prefix-list LAN out *
neighbor 102.0.0.1 remote-as 64502
*neighbor 102.0.0.1 prefix-list LAN out *

no auto-summary
!
ip route 100.0.0.0 255.255.254.0 Null0
!
*ip prefix-list LAN permit 100.0.0.0/23*
============================================
##Prefix-lists cisco
Синтаксис команды:
ip prefix-list {list-name} [seq {value}] {deny|permit} 
{network/length} [ge {value}] [le {value}]
list-name – название списка. Ваш КО. Обычно указывается, как name_in или name_out. Это подсказывает нам на входящие или исходящие маршруты будет действовать (но, конечно, на данном этапе никак не определяет).
seq – порядковый номер правила (как в ACL), чтобы проще было оперировать с ними.
deny/permit – определяем разрешать такой маршрут или нет
network/length – привычная для нас запись, вроде, 192.168.14.0/24.
А вот дальше, внимание, сложнее – возможны ещё два параметра: ge и le. Как и при настройке NAT (или в ЯП Фортран), это означает "greater or equal" и "less or equal".
То есть вы можете задать не только один конкретный префикс, но и их диапазон.
Например, такая запись
ip prefix-list NetDay permit 10.0.0.0/8 ge 10 le 16
будет означать, что будут выбраны следующие маршруты.
10.0.0.0/10, 10.0.0.0/11, 10.0.0.0/12, 10.0.0.0/13, 10.0.0.0/14, 10.0.0.0/15, 10.0.0.0/16
=====================================================================================
Сейчас мы запретим принимать анонс сети 120.0.0.0/24 через провайдер Филькин Сертификат, 
а все остальные разрешим. Запись 0.0.0.0/0 le 32 означает любые подсети с любой длиной маски (меньшей или равной 32 (0-32)).
ip prefix-list TEST_PL_IN seq 5 deny 120.0.0.0/24
ip prefix-list TEST_PL_IN seq 10 permit 0.0.0.0/0 le 32

router bgp 64500
neighbor 102.0.0.1 prefix-list TEST_PL_IN in

=============================================
##Prefix-lists cisco
Для чего нужен:
Префикс это Сеть+Маска.
Области применения различные, в основном для редистрибуции его куда либо, суть в том что бы разрешать/запрещать не просто диапазон адресов а конкретные сети с масками. 
В заметке я рассмотрю несколько примеров применения префиксов.
==================
Пример-1:
ip prefix-list TEST seq 10 permit 10.0.0.0/23 ge 24 le 24
Здесь в примере будут разрешены только префиксы 10.0.0.0/24 и 10.0.1.0/24, остальные префиксы будут запрещены. Развернуто "по буквам": 
ip prefix-list - создаем префикс-лист 
TEST           - имя префикс листа
seq 10         - Номер последовательности в листе, если не
                 указать то по-умолчанию равно 5, далше писать 
                 этот параметр не буду, т.к. всего одна строка.
permit         - разрешаем
10.0.0.0/23    - Первые 23 бита сети 10.0.0.0 неизменны т.е.
                 сеть префикса будет из диапазона  
                 10.0.0.0 - 10.0.1.255  
ge 24 le 24    - Маска должна быть больше(ge) 24 и меньше(le) 24
==================
Пример-2:
ip prefix-list DISTR permit 1.2.3.0/24 le 32 
Здесь: проверяем первые 24 бита сети 1.2.3.0 они должны совпадать, маска должна быть меньше(le) 32. Т.к. минимальное значение маски которое может быть это 24 и верхний порог не указан(ge), то по-умолчанию он равен числу фиксированных битов, в данном случае 24. Таким образом маска будет в диапазоне от 24 - 32. Все сети 1.2.3.0 с любой маской от 24 до 32 разрешаются. 
В данном случае можно создать аналогичный стандартный access-list:
access-list 1 permit 1.2.3.0 0.0.0.255 
==================
Пример-3:
ip prefix-list OUT permit 0.0.0.0/0 le 32
в данном случае проверяем первые 0 бит(они всегда будут совпадать), и разрешаем любую маску меньше(le) 32 и больше(ge) 0.
получается аналог:
access-list 1 permit any
==================
Пример-4:
ip prefix-list TEST permit 0.0.0.0/1 ge 24 le 24
Первый бит должен равняться 0 
т.е. первый октет будет находится в диапазоне:
     от   00000000 =   0
     до   01111111 = 127
остальные могу применять любое значение.
ge 24 le 24 - говорит нам что маска должна быть не больше и не меньше 24, другими словами маска должна быть жестко равна 24м. 
В итоге получаем список сетей которые разрешит данный prefix-list:
0.0.0.0/24  - 127.255.255.0/24
==================
Пример-5:
ip prefix-list DEFAULT permit 0.0.0.0/0
Маршрут по-умолчанию это маршрут до сети 0.0.0.0 с маской 0.0.0.0. Следовательно, этот префикс лист разрешает только маршрут по-умолчанию. 
Аналогичный access-list:
access-list 1 permit 0.0.0.0 0.0.0.0
==================
Пример-6:
ip prefix-list LIST permit 10.10.10.0/24 ge 28 
будут разрешены пачки маршрутов:
10.10.10.0/28     10.10.10.0/29    10.10.10.0 /30    
10.10.10.16/28    10.10.10.8/29    10.10.10.4 /30
...               ...              ....
10.10.10.240/28   10.10.10.248/29  10.10.10.252 /30   

10.10.10.0/31     10.10.10.1/32     
10.10.10.2/31     10.10.10.2/32     
...               ...
10.10.10.254/31   10.10.10.255/32

#RouteMAP
=======================
Синтаксис команды следующий:
route-map {map_name} {permit|deny} {seq}
[match {expression}]
[set {expression}]

map_name – имя карты
permit/deny – разрешаем или нет прохождение данных, подпадающих под условия route-map
seq – номер правила в route-map
match – условие подпадания трафика под данное правило.




